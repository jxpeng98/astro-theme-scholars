---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts'))
	.filter((post) => !post.data.draft)
	.sort(
		(a, b) =>
			new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime()
	);

const groupedPosts = new Map<string, typeof posts>();
for (const post of posts) {
    const year = post.data.publishedAt.getFullYear().toString();
    if (!groupedPosts.has(year)) {
        groupedPosts.set(year, []);
    }
    groupedPosts.get(year)?.push(post);
}
const years = Array.from(groupedPosts.keys()).sort((a, b) => b.localeCompare(a));
---

<Layout title="Posts">
  <div class="space-y-8">
        <header class="fade-in-up max-w-2xl">
      <h1 class="font-heading text-4xl font-bold text-gray-900 dark:text-gray-100 md:text-5xl">
        Blog
      </h1>
      <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
        Thoughts on education, technology, and the spaces in between.
      </p>
    </header>

    <div class="fade-in-up animation-delay-200 space-y-12">
      {
        years.map((year) => (
          <section class="space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-[100px_1fr] gap-4">
              <div class="md:py-1">
                <h3 class="text-sm font-bold uppercase tracking-wider text-gray-600 dark:text-gray-400 md:text-right sticky top-24">
                  {year}
                </h3>
              </div>
              <div class="flex flex-col divide-y divide-gray-200 dark:divide-gray-800">
                {groupedPosts.get(year)?.map((post) => (
                  <article class="flex flex-col gap-2 py-3 first:pt-0 last:pb-0 group">
                    <div class="flex flex-col gap-1">
                      <div class="flex items-baseline justify-between gap-4">
                        <h4 class="text-lg font-bold text-gray-900 dark:text-gray-100 leading-snug font-heading">
                          <a
                            href={`/posts/${post.slug}`}
                            class="hover:text-accent-600 dark:hover:text-accent-400 transition-colors no-underline text-inherit"
                          >
                            {post.data.title}
                          </a>
                        </h4>
                        <time
                          datetime={post.data.publishedAt.toISOString()}
                          class="shrink-0 text-sm text-gray-600 dark:text-gray-400 tabular-nums"
                        >
                          {post.data.publishedAt.toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric',
                          })}
                        </time>
                      </div>
                      {post.data.description && (
                        <p class="text-sm text-gray-600 dark:text-gray-400 max-w-2xl line-clamp-2">
                          {post.data.description}
                        </p>
                      )}
                    </div>
                  </article>
                ))}
              </div>
            </div>
          </section>
        ))
      }
    </div>
  </div>
</Layout>
