---
import { SEO } from "astro-seo";
import "uno.css";
import siteConfig from "../side.config";

export interface Props {
  title?: string;
  description?: string;
  image?: string;
}

const { title, description, image } = Astro.props;

// SEO-related variables
const seoTitle = title ? `${title} | ${siteConfig.title}` : siteConfig.title;
const seoDesc = description || siteConfig.description;
// Assumes a default OG image is specified in siteConfig, with a fallback.
const ogImage = image || "/profile.svg";

const currentYear = new Date().getFullYear();
const siteTitle = siteConfig.author || siteConfig.title;
const navLinks = siteConfig.navLinks;
const inlineLinkClasses =
	"block px-3 py-2 text-center font-medium text-slate-600 no-underline transition-colors duration-200 hover:bg-accent-100 hover:text-accent-700 dark:text-slate-300 dark:hover:bg-accent-500/20 dark:hover:text-accent-200 rounded-full";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href={siteConfig.favicon} />
    <meta name="description" content={siteConfig.description} />
    <meta name="keywords" content={siteConfig.keywords.join(", ")} />
    <meta name="generator" content={Astro.generator} />
    <title>{siteConfig.title}</title>
    <link rel="sitemap" href="/sitemap-index.xml" />

    <SEO
      title={seoTitle}
      description={seoDesc}
      openGraph={{
        basic: {
          title: seoTitle,
          type: "website",
          image: ogImage,
        },
      }}
      extend={{
        link: [{ rel: "icon", href: siteConfig.favicon }],
        meta: [{ name: "keywords", content: siteConfig.keywords.join(", ") }],
      }}
    />
    <slot name="head" />
  </head>
  <body
    class="min-h-screen bg-[#fff] dark:bg-[#121212] text-[#333333] dark:text-[#e3e3e3] font-sans transition-colors duration-300"
  >
    <div
      class="mx-auto flex min-h-screen max-w-5xl flex-col px-6 md:px-12"
    >
      <header
        class="flex flex-wrap items-center justify-between gap-y-4 py-6 md:py-10 md:flex-nowrap md:gap-x-8"
      >
        <a
          data-site-title
          class="font-heading text-2xl font-bold tracking-tight no-underline text-[#111111] dark:text-[#f5f5f7] md:order-1"
          href="/"
        >
          {siteTitle}
        </a>
        <div data-actions class="flex items-center gap-3 md:order-3">
          <button
            type="button"
            data-theme-toggle
						class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-transparent text-[#666666] transition-colors hover:bg-[#1f1f1f]/5 dark:text-[#c4c7c5] dark:hover:bg-[#e3e3e3]/10 border-none cursor-pointer"
            aria-label="Toggle color mode"
          >
            <span class="sr-only">Toggle color mode</span>
            <span
								class="i-ph-moon-stars-duotone block text-xl dark:hidden"
              aria-hidden="true"></span>
            <span
								class="i-ph-sun-dim-duotone hidden text-xl dark:block"
              aria-hidden="true"></span>
          </button>
        </div>
        <nav
          class="order-last w-full md:order-2 md:flex-1 md:min-w-0 md:overflow-hidden"
        >
          <ul
            class="m-0 flex list-none flex-wrap items-center justify-center gap-2 p-0 md:justify-end"
          >
            {
              navLinks.map((link) => (
                <li>
                  <a class="block px-4 py-2 text-sm font-medium text-[#666666] no-underline transition-all hover:text-[#111111] dark:text-[#c4c7c5] dark:hover:text-[#e3e3e3] rounded-full hover:bg-[#1f1f1f]/5 dark:hover:bg-[#e3e3e3]/10" href={link.href}>
                    {link.label}
                  </a>
                </li>
              ))
            }
          </ul>
        </nav>
      </header>

      <main class="flex-1 space-y-10 md:space-y-16">
        <slot />
      </main>

      <footer
        class="mt-12 border-t border-[#1f1f1f]/10 pt-8 text-sm text-[#666666] dark:border-[#e3e3e3]/10 dark:text-[#c4c7c5] md:mt-20 pb-10"
      >
        <p class="m-0 text-center md:text-left">
          &copy; {
            `${currentYear} ${siteConfig.author}. ${siteConfig.footer.copyright}`
          }
        </p>
      </footer>
    </div>

    <script is:inline>
      (() => {
        // --- Theme management ---
        const STORAGE_KEY = "site-theme";
        const getStored = () => {
          try {
            return localStorage.getItem(STORAGE_KEY);
          } catch (err) {
            return null;
          }
        };

        const applyTheme = (mode) => {
          if (mode === "dark") {
            document.documentElement.classList.add("dark");
          } else {
            document.documentElement.classList.remove("dark");
          }
        };

        const stored = getStored();
        if (stored) {
          applyTheme(stored);
        } else if (
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
        ) {
          applyTheme("dark");
        }

        // --- Event Listeners ---
        document.addEventListener("DOMContentLoaded", () => {
          // Theme toggle buttons
          const toggleButtons = document.querySelectorAll(
            "[data-theme-toggle]"
          );
          toggleButtons.forEach((btn) => {
            btn.addEventListener("click", () => {
              const isDark = document.documentElement.classList.toggle("dark");
              try {
                localStorage.setItem(STORAGE_KEY, isDark ? "dark" : "light");
              } catch (err) {
                /* ignore */
              }
            });
          });

          // System theme change
          if (window.matchMedia) {
            window
              .matchMedia("(prefers-color-scheme: dark)")
              .addEventListener("change", (event) => {
                if (!getStored()) {
                  applyTheme(event.matches ? "dark" : "light");
                }
              });
          }
        });
      })();
    </script>
  </body>
</html>
